---
title: "elasticsearch 原理"
date: 2020-01-17T15:26:15Z
draft: false
weight: 3
---


# elasticsearch 原理

//https://zhuanlan.zhihu.com/p/635445173

//https://blog.csdn.net/sinat_16658263/article/details/90444038


//https://zhuanlan.zhihu.com/p/334348919


## 集群

+ 集群 有多个node节点(master node,data node,replica node) 主节点和副节点 每个节点可能存储数据也可能只是作为我单独的Lucene 索引实例

+ 协调节点 

用户的请求可以随机发往任何一个节点，并由该节点负责分发请求、收集结果等操作，而不需要主节点转发。这种节点可称之为协调节点，集群中的任何节点都可以充当协调节点的角色。每个节点之间都会保持联系



+ 例子1

master node (1,2)  all node (1,2,3,4,5,6)

init master node 1

候选主节点主节点有1和2 从initial_master_nodes中推举出来主节点 主节点：负责索引的添加、删除，跟踪哪些节点是群集的一部分，对分片进行分配、收集集群中各节点的状态等，稳定的主节点对集群的健康是非常重要。
进来后由负载均衡判断  假如主节点请求1节点处理 那么1节点就作为了**协调节点**,然后1节点将请求发给各个分节点;  分节点再向各个分片发送检索请求; 分片检索结果在节点合并; 各个节点结果在协调节点合并; 协调节点合并并且**后续操作**完成以后才把结果响应给客服端。




## 索引

+ ES将数据存储于一个或多个索引中，索引是具有类似特性的文档的集合



+ primary shard(主分片)  每个主分片都有一个复制分片 因此一个主分片的副分片是大于等于1

+ 一个分片(shard)是一个最小级别“工作单元(worker unit)”，它只是保存了索引中所有数据的一部分。

+ 索引中的每个文档属于一个单独的主分片，所以主分片的数量决定了索引最多能存储多少数据

+ 索引 [ {id:"1",name:"张三"} , {id:"2",name:"李四"} ,{id:"3",name:"王麻子"} ]

+ 分片1 [{id:"1",name:"张三"} , {id:"2",name:"李四"}]
+ 分片2 [{id:"3",name:"王麻子"} ]



## 节点




## 索引