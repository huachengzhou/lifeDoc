---
title : 'mysql > 数据库设计三范式'
date : '2021-02-15'
draft : false
tags : ["mysql"]
categories : ["databases","index"]
author : 'zch'
description : '测试博客'
lastmod : '2021-02-15'
---

>设计关系数据库时，遵从不同的规范要求，设计出合理的关系型数据库，这些不同的规范要求被称为不同的范式，各种范式呈递次规范，越高的范式数据库冗余越小。

>目前关系数据库有六种范式：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式(4NF）和第五范式（5NF，又称完美范式）。
# 数据库三范式
## 第一范式（1NF）
+ 所谓第一范式（1NF）是指在关系模型中，对域添加的一个规范要求，所有的域都应该是原子性的，即数据库表的每一列都是不可分割的原子数据项，而不能是集合，数组，记录等非原子数据项。即实体中的某个属性有多个值时，必须拆分为不同的属性。在符合第一范式（1NF）表中的每个域值只能是实体的一个属性或一个属性的一部分。简而言之，第一范式就是无重复的域。
+ 说明：在任何一个关系数据库中，第一范式（1NF）是对关系模式的设计基本要求，一般设计中都必须满足第一范式（1NF）。不过有些关系模型中突破了1NF的限制，这种称为非1NF的关系模型。换句话说，是否必须满足1NF的最低要求，主要依赖于所使用的关系模型。
## 第二范式（2NF）
* 在1NF的基础上，非码属性必须完全依赖于候选码（在1NF基础上消除非主属性对主码的部分函数依赖）
* 第二范式（2NF）是在第一范式（1NF）的基础上建立起来的，即满足第二范式（2NF）必须先满足第一范式（1NF）。第二范式（2NF）要求数据库表中的每个实例或记录必须可以被唯一地区分。选取一个能区分每个实体的属性或属性组，作为实体的唯一标识。例如在员工表中的身份证号码即可实现每个一员工的区分，该身份证号码即为候选键，任何一个候选键都可以被选作主键。在找不到候选键时，可额外增加属性以实现区分，如果在员工关系中，没有对其身份证号进行存储，而姓名可能会在数据库运行的某个时间重复，无法区分出实体时，设计辟如ID等不重复的编号以实现区分，被添加的编号或ID选作主键。（该主键的添加是在ER设计时添加，不是建库时随意添加）
* 第二范式（2NF）要求实体的属性完全依赖于主关键字。所谓完全依赖是指不能存在仅依赖主关键字一部分的属性，如果存在，那么这个属性和主关键字的这一部分应该分离出来形成一个新的实体，新实体与原实体之间是一对多的关系。为实现区分通常需要为表加上一个列，以存储各个实例的唯一标识。简而言之，第二范式就是在第一范式的基础上属性完全依赖于主键。
## 第三范式（3NF）
* 在2NF基础上，任何非主属性不依赖于其它非主属性（在2NF基础上消除传递依赖）
* 第三范式（3NF）是第二范式（2NF）的一个子集，即满足第三范式（3NF）必须满足第二范式（2NF）。简而言之，第三范式（3NF）要求一个关系中不包含已在其它关系已包含的非主关键字信息。例如，存在一个部门信息表，其中每个部门有部门编号（dept_id）、部门名称、部门简介等信息。那么在员工信息表中列出部门编号后就不能再将部门名称、部门简介等与部门有关的信息再加入员工信息表中。如果不存在部门信息表，则根据第三范式（3NF）也应该构建它，否则就会有大量的数据冗余。简而言之，第三范式就是属性不依赖于其它非主属性，也就是在满足2NF的基础上，任何非主属性不得传递依赖于主属性。


# 巴斯-科德范式（BCNF）
> Boyce-Codd Normal Form（巴斯-科德范式）
+ 在3NF基础上，任何非主属性不能对主键子集依赖（在3NF基础上消除对主码子集的依赖）
+ 巴斯-科德范式（BCNF）是第三范式（3NF）的一个子集，即满足巴斯-科德范式（BCNF）必须满足第三范式（3NF）。通常情况下，巴斯-科德范式被认为没有新的设计规范加入，只是对第二范式与第三范式中设计规范要求更强，因而被认为是修正第三范式，也就是说，它事实上是对第三范式的修正，使数据库冗余度更小。这也是BCNF不被称为第四范式的原因。某些书上，根据范式要求的递增性将其称之为第四范式是不规范，也是更让人不容易理解的地方。而真正的第四范式，则是在设计规范中添加了对多值及依赖的要求。
+ 定义：关系模式R<U,F>∈1FNF,若X→Y且Y不是X的子集时X必含有码，则R<U,F>∈BCNF。也就是说，关系模式R<U,F>中，若每一个决定因素都包含码，则R<U,F>∈BCNF。
> 由BCNF的定义可以得到结论，一个满足BCNF的关系模式有：
* -所有非主属性对每一个码都是完全函数依赖。
* -所有主属性对每一个不包含它的码也是完全函数依赖。
* -没有任何属性完全函数依赖于非码的任何一组属性。
若R∈BCNF，按定义排除了任何属性对码的传递依赖与部分依赖，所以R∈3NF。[1] 
* 一般关系型数据库设计中，达到BCNF就可以了！


#【数据库五大约束】

+ 1.primary KEY:设置主键约束；
+ 2.UNIQUE：设置唯一性约束，不能有重复值；
+ 3.DEFAULT 默认值约束，height DOUBLE(3,2)DEFAULT 1.2 height不输入是默认为1,2
+ 4.NOT NULL：设置非空约束，该字段不能为空；
+ 5.FOREIGN key :设置外键约束。


# 【主键】
* 1.主键的注意事项？
主键默认非空，默认唯一性约束，只有主键才能设置自动增长，自动增长一定是主键，主键不一定自动增长；
* 2.设置主键的方式？
在定义列时设置：ID INT PRIMARY KEY
在列定义完之后设置：primary KEY（id）

# 【外键】

+ 1.设置外键的注意事项：   

只有INNODB的数据库引擎支持外键，修改my.ini文件设置default-storage-engine=INNODB    外键必须与参照列的数据类型必须相同（数值型要求长度和无符号都相同，字符串要求类型相同，长度可以不同）。

+ 2设置外键的语法：

   CONSTRAINT 外键名 FOREIGN KEY (外键字段)REFERENCES 参照表 (参照字段)    ON DELETE SET NULL ON UPDATE CASCADE 设置参照完整性

+ 3.外键约束的参照操作？  

>参照表的完整性操作：当对参照表的参照字段进行删除或更新时，外键表中的外键如何应对；   

>参照操作可选值：

* RESTRICT拒绝参照表删除或更新参照字段；               

* RESTRICT和NO ACTION相同，但这个指令只在mysql生效;                

* CASCADE删除或更新参照表的参照字段时，外键表的记录同步删除更新；               

* SET NULL 删除或更新参照表的参照字段时，外键表的外键设为NULL;
      
      

+ 1NF, 字段不可再分。这个关系数据库强制了，想建立复合的字段也建立不起来。关系数据库出现之前才有这个问题。
+ 2NF，主键依赖，就是一张表里面的字段，必须是跟主键相关的，不能把无关的数据放进来。主键依赖，实质就是，这个信息如果是对象的属性，就放进来，否则就不放。
+ 3NF，就是不能重复存储相同的信息。这个情况，其实是在一个对象里引用了另外一个对象，这个时候，存一个引用就够了，而不是重复的存储这个对象的多个副本。
+ 2NF和3NF的本质是，对象的属性依赖对象。数据库的主键，作用是什么？它用来唯一的标识这个对象，同时，用来给其他对象引用 引用 引用（重要的事情说三次）
所以，实战中，所有数据库都是用int类型做主键（int，或者bigint），而且，主键一律是自增，这是不成文的规则，凡是不遵守这个规则的，都是错的（虽然理论上可以）这样，
数据库写数据的时候，几乎是永远不写入同一个对象的重复信息的，需要重复的时候，只写这个对象的ID

```
create table Courses(
	CourseID int identity primary key,
	CourseName nvarchar(50) not null
)
```

```
create table Departments( 
DepartmentID int identity primary key,	DepartmentName nvarchar(50) not null,	HeadName nvarchar(50) not null);

create table Students(	StudentID int identity primary key,	Name nvarchar(50),	
DepartmentID int not null	Constraint FkStudentDepartment foreign key (DepartmentID) references Departments(DepartmentID));

create table Results(	
ResultID int identity primary key,	StudentID int not null,	CourseID int not null,	Result int not null,
Constraint FkResultStudent foreign key  (StudentID) references Students(StudentID));
```

## 11.数据库设计基础原则：三范式
+ 1）表必须有主键
+ 2）字段内容不能是其他的字段加工而成
+ 3）行数据不能相同

## 12.现今业界主流数据库设计原则：反三范式
* 1）表不是必须有主键
* 2）字段存一些加工后的中间的结果，冗余设计
* 3）记录冗余

>三范式追求的目标存储空间尽量小；反三范式追求的目标是查询速度。
创建数据库设计时首先按三范式设计，然后局部优化。


